define("core/loop/Loop",["lodash"],function(e){var t=function(){this._fcts=[]};return t.prototype.add=function(e){return this._fcts.push(e),e},t.prototype.remove=function(e){var t=this._fcts.indexOf(e);-1!==t&&this._fcts.splice(t,1)},t.prototype.update=function(t){e.each(this._fcts,function(e){e(t)})},t}),define("core/loop/RenderingLoop",["core/loop/Loop","lodash"],function(e,t){var o=function(){e.call(this),this.maxDelta=.2;var o=null,n=null,r=function(e){o=requestAnimationFrame(r),n=n||e-1e3/60;var t=Math.min(1e3*this.maxDelta,e-n);n=e,this.update(t/1e3)}.bind(this);this.start=function(){console.assert(!1===this.isRunning()),o=requestAnimationFrame(r)},this.isRunning=function(){return!!o},this.stop=function(){null!==o&&(cancelAnimationFrame(o),o=null)}};return o.prototype=t.create(e.prototype,{constructor:o}),o}),define("core/PointerRay",["three"],function(e){var o=new e.Raycaster,n=new e.Vector2;return function(t){this.getRay=function(e){return n.set(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1),o.setFromCamera(n,t.camera),o.ray}}}),define("vendor/three/renderers/Projector",["three"],function(je){return je.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},je.RenderableFace=function(){this.id=0,this.v1=new je.RenderableVertex,this.v2=new je.RenderableVertex,this.v3=new je.RenderableVertex,this.normalModel=new je.Vector3,this.vertexNormalsModel=[new je.Vector3,new je.Vector3,new je.Vector3],this.vertexNormalsLength=0,this.color=new je.Color,this.material=null,this.uvs=[new je.Vector2,new je.Vector2,new je.Vector2],this.z=0,this.renderOrder=0},je.RenderableVertex=function(){this.position=new je.Vector3,this.positionWorld=new je.Vector3,this.positionScreen=new je.Vector4,this.visible=!0},je.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},je.RenderableLine=function(){this.id=0,this.v1=new je.RenderableVertex,this.v2=new je.RenderableVertex,this.vertexColors=[new je.Color,new je.Color],this.material=null,this.z=0,this.renderOrder=0},je.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new je.Vector2,this.material=null,this.renderOrder=0},je.Projector=function(){var t,J,r,ee,te,oe,ne,re,i,ie,ae,o=[],n=0,se=[],a=0,s=[],c=0,l=[],p=0,u=[],h=0,ce={objects:[],lights:[],elements:[]},le=new je.Vector3,pe=new je.Vector4,v=new je.Box3(new je.Vector3(-1,-1,-1),new je.Vector3(1,1,1)),b=new je.Box3,y=new Array(3),ue=new je.Matrix4,he=new je.Matrix4,de=new je.Matrix4,me=new je.Matrix3,fe=new je.Frustum,ve=new je.Vector4,be=new je.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var ye=new function(){var l=[],p=[],u=[],h=null,d=new je.Matrix3;function n(e){var t=e.position,o=e.positionWorld,n=e.positionScreen;o.copy(t).applyMatrix4(ae),n.copy(o).applyMatrix4(he);var r=1/n.w;n.x*=r,n.y*=r,n.z*=r,e.visible=-1<=n.x&&n.x<=1&&-1<=n.y&&n.y<=1&&-1<=n.z&&n.z<=1}function m(e,t,o){return!0===e.visible||!0===t.visible||!0===o.visible||(y[0]=e.positionScreen,y[1]=t.positionScreen,y[2]=o.positionScreen,v.intersectsBox(b.setFromPoints(y)))}function f(e,t,o){return(o.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(o.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){(h=e).material,d.getNormalMatrix(h.matrixWorld),l.length=0,p.length=0,u.length=0},projectVertex:n,checkTriangleVisibility:m,checkBackfaceCulling:f,pushVertex:function(e,t,o){(r=xe()).position.set(e,t,o),n(r)},pushNormal:function(e,t,o){l.push(e,t,o)},pushColor:function(e,t,o){p.push(e,t,o)},pushUv:function(e,t){u.push(e,t)},pushLine:function(e,t){var o=se[e],n=se[t];o.positionScreen.copy(o.position).applyMatrix4(de),n.positionScreen.copy(n.position).applyMatrix4(de),!0===Ce(o.positionScreen,n.positionScreen)&&(o.positionScreen.multiplyScalar(1/o.positionScreen.w),n.positionScreen.multiplyScalar(1/n.positionScreen.w),(ne=_e()).id=h.id,ne.v1.copy(o),ne.v2.copy(n),ne.z=Math.max(o.positionScreen.z,n.positionScreen.z),ne.renderOrder=h.renderOrder,ne.material=h.material,h.material.vertexColors===je.VertexColors&&(ne.vertexColors[0].fromArray(p,3*e),ne.vertexColors[1].fromArray(p,3*t)),ce.elements.push(ne))},pushTriangle:function(e,t,o,n){var r=se[e],i=se[t],a=se[o];if(!1!==m(r,i,a)&&(n.side===je.DoubleSide||!0===f(r,i,a))){(te=Ee()).id=h.id,te.v1.copy(r),te.v2.copy(i),te.v3.copy(a),te.z=(r.positionScreen.z+i.positionScreen.z+a.positionScreen.z)/3,te.renderOrder=h.renderOrder,le.subVectors(a.position,i.position),pe.subVectors(r.position,i.position),le.cross(pe),te.normalModel.copy(le),te.normalModel.applyMatrix3(d).normalize();for(var s=0;s<3;s++){var c=te.vertexNormalsModel[s];c.fromArray(l,3*arguments[s]),c.applyMatrix3(d).normalize(),te.uvs[s].fromArray(u,2*arguments[s])}te.vertexNormalsLength=3,(te.material=n).vertexColors!==je.FaceColors&&n.vertexColors!==je.VertexColors||te.color.fromArray(p,3*e),ce.elements.push(te)}}}};function ge(e){(t=function(){if(J!==n)return o[J++];var e=new je.RenderableObject;return o.push(e),n++,J++,e}()).id=e.id,t.object=e,le.setFromMatrixPosition(e.matrixWorld),le.applyMatrix4(he),t.z=le.z,t.renderOrder=e.renderOrder,ce.objects.push(t)}function we(e,t,o){var n=1/e.w;e.z*=n,-1<=e.z&&e.z<=1&&((i=function(){if(ie!==h)return u[ie++];var e=new je.RenderableSprite;return u.push(e),h++,ie++,e}()).id=t.id,i.x=e.x*n,i.y=e.y*n,i.z=e.z,i.renderOrder=t.renderOrder,i.object=t,i.rotation=t.rotation,i.scale.x=t.scale.x*Math.abs(i.x-(e.x+o.projectionMatrix.elements[0])/(e.w+o.projectionMatrix.elements[12])),i.scale.y=t.scale.y*Math.abs(i.y-(e.y+o.projectionMatrix.elements[5])/(e.w+o.projectionMatrix.elements[13])),i.material=t.material,ce.elements.push(i))}function xe(){if(ee!==a)return se[ee++];var e=new je.RenderableVertex;return se.push(e),a++,ee++,e}function Ee(){if(oe!==c)return s[oe++];var e=new je.RenderableFace;return s.push(e),c++,oe++,e}function _e(){if(re!==p)return l[re++];var e=new je.RenderableLine;return l.push(e),p++,re++,e}function Me(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function Ce(e,t){var o=0,n=1,r=e.z+e.w,i=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return 0<=r&&0<=i&&0<=a&&0<=s||!(r<0&&i<0||a<0&&s<0)&&(r<0?o=Math.max(o,r/(r-i)):i<0&&(n=Math.min(n,r/(r-i))),a<0?o=Math.max(o,a/(a-s)):s<0&&(n=Math.min(n,a/(a-s))),!(n<o)&&(e.lerp(t,o),t.lerp(e,1-n),!0))}this.projectScene=function(e,t,o,n){ie=re=oe=0,!(ce.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ue.copy(t.matrixWorldInverse),he.multiplyMatrices(t.projectionMatrix,ue),fe.setFromMatrix(he),J=0,ce.objects.length=0,ce.lights.length=0,function e(t){if(!1!==t.visible){if(t instanceof je.Light)ce.lights.push(t);else if(t instanceof je.Mesh||t instanceof je.Line||t instanceof je.Points){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===fe.intersectsObject(t))return;ge(t)}else if(t instanceof je.Sprite){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===fe.intersectsSprite(t))return;ge(t)}for(var o=t.children,n=0,r=o.length;n<r;n++)e(o[n])}}(e),!0===o&&ce.objects.sort(Me);for(var r=ce.objects,i=0,a=r.length;i<a;i++){var s=r[i].object,c=s.geometry;if(ye.setObject(s),ae=s.matrixWorld,ee=0,s instanceof je.Mesh){if(c instanceof je.BufferGeometry){var l=s.material,p=Array.isArray(l),u=c.attributes,h=c.groups;if(void 0===u.position)continue;for(var d=0,m=(Q=u.position.array).length;d<m;d+=3){var f=Q[d],v=Q[d+1],b=Q[d+2];if(!0===l.morphTargets)for(var y=c.morphAttributes.position,g=s.morphTargetInfluences,w=0,x=y.length;w<x;w++){if(0!==(R=g[w]))f+=((z=y[w]).getX(d/3)-Q[d])*R,v+=(z.getY(d/3)-Q[d+1])*R,b+=(z.getZ(d/3)-Q[d+2])*R}ye.pushVertex(f,v,b)}if(void 0!==u.normal){var E=u.normal.array;for(d=0,m=E.length;d<m;d+=3)ye.pushNormal(E[d],E[d+1],E[d+2])}if(void 0!==u.color)for(d=0,m=(K=u.color.array).length;d<m;d+=3)ye.pushColor(K[d],K[d+1],K[d+2]);if(void 0!==u.uv){var _=u.uv.array;for(d=0,m=_.length;d<m;d+=2)ye.pushUv(_[d],_[d+1])}if(null!==c.index){var M=c.index.array;if(0<h.length)for(var C=0;C<h.length;C++){var j=h[C];if(void 0!==(l=!0===p?s.material[j.materialIndex]:s.material))for(d=j.start,m=j.start+j.count;d<m;d+=3)ye.pushTriangle(M[d],M[d+1],M[d+2],l)}else for(d=0,m=M.length;d<m;d+=3)ye.pushTriangle(M[d],M[d+1],M[d+2],l)}else if(0<h.length)for(C=0;C<h.length;C++){j=h[C];if(void 0!==(l=!0===p?s.material[j.materialIndex]:s.material))for(d=j.start,m=j.start+j.count;d<m;d+=3)ye.pushTriangle(d,d+1,d+2,l)}else for(d=0,m=Q.length/3;d<m;d+=3)ye.pushTriangle(d,d+1,d+2,l)}else if(c instanceof je.Geometry){var O=c.vertices,S=c.faces,T=c.faceVertexUvs[0];me.getNormalMatrix(ae);l=s.material,p=Array.isArray(l);for(var V=0,P=O.length;V<P;V++){var L=O[V];if(le.copy(L),!0===l.morphTargets)for(y=c.morphTargets,g=s.morphTargetInfluences,w=0,x=y.length;w<x;w++){var R;if(0!==(R=g[w])){var z,k=(z=y[w]).vertices[V];le.x+=(k.x-L.x)*R,le.y+=(k.y-L.y)*R,le.z+=(k.z-L.z)*R}}ye.pushVertex(le.x,le.y,le.z)}for(var D=0,H=S.length;D<H;D++){var N=S[D];if(void 0!==(l=!0===p?s.material[N.materialIndex]:s.material)){var A=l.side,I=se[N.a],F=se[N.b],$=se[N.c];if(!1!==ye.checkTriangleVisibility(I,F,$)){var U=ye.checkBackfaceCulling(I,F,$);if(A!==je.DoubleSide){if(A===je.FrontSide&&!1===U)continue;if(A===je.BackSide&&!0===U)continue}(te=Ee()).id=s.id,te.v1.copy(I),te.v2.copy(F),te.v3.copy($),te.normalModel.copy(N.normal),!1!==U||A!==je.BackSide&&A!==je.DoubleSide||te.normalModel.negate(),te.normalModel.applyMatrix3(me).normalize();for(var Y=N.vertexNormals,W=0,X=Math.min(Y.length,3);W<X;W++){var Z=te.vertexNormalsModel[W];Z.copy(Y[W]),!1!==U||A!==je.BackSide&&A!==je.DoubleSide||Z.negate(),Z.applyMatrix3(me).normalize()}te.vertexNormalsLength=Y.length;var G=T[D];if(void 0!==G)for(var B=0;B<3;B++)te.uvs[B].copy(G[B]);te.color=N.color,te.material=l,te.z=(I.positionScreen.z+F.positionScreen.z+$.positionScreen.z)/3,te.renderOrder=s.renderOrder,ce.elements.push(te)}}}}}else if(s instanceof je.Line){if(de.multiplyMatrices(he,ae),c instanceof je.BufferGeometry){if(void 0!==(u=c.attributes).position){for(d=0,m=(Q=u.position.array).length;d<m;d+=3)ye.pushVertex(Q[d],Q[d+1],Q[d+2]);if(void 0!==u.color){var K;for(d=0,m=(K=u.color.array).length;d<m;d+=3)ye.pushColor(K[d],K[d+1],K[d+2])}if(null!==c.index)for(d=0,m=(M=c.index.array).length;d<m;d+=2)ye.pushLine(M[d],M[d+1]);else{var q=s instanceof je.LineSegments?2:1;for(d=0,m=Q.length/3-1;d<m;d+=q)ye.pushLine(d,d+1)}}}else if(c instanceof je.Geometry){if(0===(O=s.geometry.vertices).length)continue;(I=xe()).positionScreen.copy(O[0]).applyMatrix4(de);for(q=s instanceof je.LineSegments?2:1,V=1,P=O.length;V<P;V++)(I=xe()).positionScreen.copy(O[V]).applyMatrix4(de),0<(V+1)%q||(F=se[ee-2],ve.copy(I.positionScreen),be.copy(F.positionScreen),!0===Ce(ve,be)&&(ve.multiplyScalar(1/ve.w),be.multiplyScalar(1/be.w),(ne=_e()).id=s.id,ne.v1.positionScreen.copy(ve),ne.v2.positionScreen.copy(be),ne.z=Math.max(ve.z,be.z),ne.renderOrder=s.renderOrder,ne.material=s.material,s.material.vertexColors===je.VertexColors&&(ne.vertexColors[0].copy(s.geometry.colors[V]),ne.vertexColors[1].copy(s.geometry.colors[V-1])),ce.elements.push(ne)))}}else if(s instanceof je.Points){if(de.multiplyMatrices(he,ae),c instanceof je.Geometry)for(V=0,P=(O=s.geometry.vertices).length;V<P;V++){L=O[V];pe.set(L.x,L.y,L.z,1),pe.applyMatrix4(de),we(pe,s,t)}else if(c instanceof je.BufferGeometry){if(void 0!==(u=c.attributes).position){var Q;for(d=0,m=(Q=u.position.array).length;d<m;d+=3)pe.set(Q[d],Q[d+1],Q[d+2],1),pe.applyMatrix4(de),we(pe,s,t)}}}else s instanceof je.Sprite&&(s.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,s.matrixWorld),pe.set(ae.elements[12],ae.elements[13],ae.elements[14],1),pe.applyMatrix4(he),we(pe,s,t))}return!0===n&&ce.elements.sort(Me),ce}},je.Projector}),define("core/Domevents",["three","vendor/three/renderers/Projector"],function(f){var l=function(e,t){this._camera=e||null,this._domElement=t||document,this._projector=new f.Projector,this._selected=null,this._boundObjs={};var o=this;this._$onClick=function(){o._onClick.apply(o,arguments)},this._$onDblClick=function(){o._onDblClick.apply(o,arguments)},this._$onMouseMove=function(){o._onMouseMove.apply(o,arguments)},this._$onMouseDown=function(){o._onMouseDown.apply(o,arguments)},this._$onMouseUp=function(){o._onMouseUp.apply(o,arguments)},this._$onTouchMove=function(){o._onTouchMove.apply(o,arguments)},this._$onTouchStart=function(){o._onTouchStart.apply(o,arguments)},this._$onTouchEnd=function(){o._onTouchEnd.apply(o,arguments)},this._$onContextmenu=function(){o._onContextmenu.apply(o,arguments)},this._domElement.addEventListener("click",this._$onClick,!1),this._domElement.addEventListener("dblclick",this._$onDblClick,!1),this._domElement.addEventListener("mousemove",this._$onMouseMove,!1),this._domElement.addEventListener("mousedown",this._$onMouseDown,!1),this._domElement.addEventListener("mouseup",this._$onMouseUp,!1),this._domElement.addEventListener("touchmove",this._$onTouchMove,!1),this._domElement.addEventListener("touchstart",this._$onTouchStart,!1),this._domElement.addEventListener("touchend",this._$onTouchEnd,!1),this._domElement.addEventListener("contextmenu",this._$onContextmenu,!1)};return l.prototype.destroy=function(){this._domElement.removeEventListener("click",this._$onClick,!1),this._domElement.removeEventListener("dblclick",this._$onDblClick,!1),this._domElement.removeEventListener("mousemove",this._$onMouseMove,!1),this._domElement.removeEventListener("mousedown",this._$onMouseDown,!1),this._domElement.removeEventListener("mouseup",this._$onMouseUp,!1),this._domElement.removeEventListener("touchmove",this._$onTouchMove,!1),this._domElement.removeEventListener("touchstart",this._$onTouchStart,!1),this._domElement.removeEventListener("touchend",this._$onTouchEnd,!1),this._domElement.removeEventListener("contextmenu",this._$onContextmenu,!1)},l.eventNames=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],l.prototype._getRelativeMouseXY=function(e){var t=e.target||e.srcElement;3===t.nodeType&&(t=t.parentNode);var o={x:0,y:0},n=t,r=getComputedStyle(n,null);for(o.y+=parseInt(r.getPropertyValue("padding-top"),10),o.x+=parseInt(r.getPropertyValue("padding-left"),10);o.x+=n.offsetLeft,o.y+=n.offsetTop,r=getComputedStyle(n,null),o.x+=parseInt(r.getPropertyValue("border-left-width"),10),o.y+=parseInt(r.getPropertyValue("border-top-width"),10),n=n.offsetParent;);var i=t===window?window.innerWidth:t.offsetWidth,a=t===window?window.innerHeight:t.offsetHeight;return{x:+(e.pageX-o.x)/i*2-1,y:-(e.pageY-o.y)/a*2+1}},l.prototype._objectCtxInit=function(e){e._3xDomEvent={}},l.prototype._objectCtxDeinit=function(e){delete e._3xDomEvent},l.prototype._objectCtxIsInit=function(e){return!!e._3xDomEvent},l.prototype._objectCtxGet=function(e){return e._3xDomEvent},l.prototype.camera=function(e){return e&&(this._camera=e),this._camera},l.prototype.addEventListener=l.prototype.bind=function(e,t,o,n){console.assert(-1!==l.eventNames.indexOf(t),"not available events:"+t),this._objectCtxIsInit(e)||this._objectCtxInit(e);var r=this._objectCtxGet(e);r[t+"Handlers"]||(r[t+"Handlers"]=[]),r[t+"Handlers"].push({callback:o,useCapture:n}),void 0===this._boundObjs[t]&&(this._boundObjs[t]=[]),this._boundObjs[t].push(e)},l.prototype.removeEventListener=l.prototype.unbind=function(e,t,o,n){console.assert(-1!==l.eventNames.indexOf(t),"not available events:"+t),this._objectCtxIsInit(e)||this._objectCtxInit(e);var r=this._objectCtxGet(e);r[t+"Handlers"]||(r[t+"Handlers"]=[]);for(var i=r[t+"Handlers"],a=0;a<i.length;a++){var s=i[a];if(o==s.callback&&n==s.useCapture){i.splice(a,1);break}}var c=this._boundObjs[t].indexOf(e);console.assert(-1!==c),this._boundObjs[t].splice(c,1)},l.prototype._bound=function(e,t){var o=this._objectCtxGet(t);return!!o&&!!o[e+"Handlers"]},l.prototype._onMove=function(e,t,o,n){var r=this._boundObjs[e];if(void 0!==r&&0!==r.length){var i=new f.Vector3,a=new f.Raycaster,s=new f.Vector3;this._camera instanceof f.OrthographicCamera?(i.set(t,o,-1),i.unproject(this._camera),s.set(0,0,-1).transformDirection(this._camera.matrixWorld),a.set(i,s)):this._camera instanceof f.PerspectiveCamera&&(i.set(t,o,.5),i.unproject(this._camera),a.set(this._camera.position,i.sub(this._camera.position).normalize()));var c=a.intersectObjects(r),l=this._selected;if(0<c.length){var p,u,h,d=c[0],m=d.object;this._selected=m,h=this._bound("mousemove",m),l!=m&&(p=this._bound("mouseover",m),u=l&&this._bound("mouseout",l))}else u=l&&this._bound("mouseout",l),this._selected=null;h&&this._notify("mousemove",m,n,d),p&&this._notify("mouseover",m,n,d),u&&this._notify("mouseout",l,n,d)}},l.prototype._onEvent=function(e,t,o,n){var r=this._boundObjs[e];if(void 0!==r&&0!==r.length){var i=new f.Vector3,a=new f.Raycaster,s=new f.Vector3;this._camera instanceof f.OrthographicCamera?(i.set(t,o,-1),i.unproject(this._camera),s.set(0,0,-1).transformDirection(this._camera.matrixWorld),a.set(i,s)):this._camera instanceof f.PerspectiveCamera&&(i.set(t,o,.5),i.unproject(this._camera),a.set(this._camera.position,i.sub(this._camera.position).normalize()));var c=a.intersectObjects(r,!0);if(0!==c.length){for(var l=c[0],p=l.object,u=this._objectCtxGet(p),h=p.parent;void 0===u&&h;)u=this._objectCtxGet(h),h=h.parent;u&&this._notify(e,p,n,l)}}},l.prototype._notify=function(e,t,o,n){var r=this._objectCtxGet(t),i=r?r[e+"Handlers"]:null;if(console.assert(4===arguments.length),r&&i&&0!==i.length){i=r[e+"Handlers"];for(var a=0;a<i.length;a++){var s=i[a],c=!0;s.callback({type:e,target:t,origDomEvent:o,intersect:n,stopPropagation:function(){c=!1}}),c&&(!1===s.useCapture&&t.parent&&this._notify(e,t.parent,o,n))}}else t.parent&&this._notify(e,t.parent,o,n)},l.prototype._onMouseDown=function(e){return this._onMouseEvent("mousedown",e)},l.prototype._onMouseUp=function(e){return this._onMouseEvent("mouseup",e)},l.prototype._onMouseEvent=function(e,t){var o=this._getRelativeMouseXY(t);this._onEvent(e,o.x,o.y,t)},l.prototype._onMouseMove=function(e){var t=this._getRelativeMouseXY(e);this._onMove("mousemove",t.x,t.y,e),this._onMove("mouseover",t.x,t.y,e),this._onMove("mouseout",t.x,t.y,e)},l.prototype._onClick=function(e){this._onMouseEvent("click",e)},l.prototype._onDblClick=function(e){this._onMouseEvent("dblclick",e)},l.prototype._onContextmenu=function(e){this._onMouseEvent("contextmenu",e)},l.prototype._onTouchStart=function(e){return this._onTouchEvent("mousedown",e)},l.prototype._onTouchEnd=function(e){return this._onTouchEvent("mouseup",e)},l.prototype._onTouchMove=function(e){if(1==e.touches.length){e.preventDefault();var t=+e.touches[0].pageX/window.innerWidth*2-1,o=-e.touches[0].pageY/window.innerHeight*2+1;this._onMove("mousemove",t,o,e),this._onMove("mouseover",t,o,e),this._onMove("mouseout",t,o,e)}},l.prototype._onTouchEvent=function(e,t){if(1==t.touches.length){t.preventDefault();var o=+t.touches[0].pageX/window.innerWidth*2-1,n=-t.touches[0].pageY/window.innerHeight*2+1;this._onEvent(e,o,n,t)}},l}),define("json!core/viewport/model.json",function(){return{defaults:{antialias:"default",renderer:"standard",postprocessing:!1,shadowMap:!0,clearColor:"lightgrey",alpha:!0,opacity:.5,camFov:45,camControl:!0},bounds:{antialias:{list:["none","default","fxaa","smaa"],type:"array"},renderer:{list:["deferred","standard"],type:"array"},camControl:{type:"boolean"}}}}),define("vendor/three/controls/OrbitControls",["three"],function(B){return B.OrbitControls=function(e,t){var o,n,r,i,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new B.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:B.MOUSE.LEFT,MIDDLE:B.MOUSE.MIDDLE,RIGHT:B.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),h=u.NONE},this.update=(o=new B.Vector3,n=(new B.Quaternion).setFromUnitVectors(e.up,new B.Vector3(0,1,0)),r=n.clone().inverse(),i=new B.Vector3,a=new B.Quaternion,function(){var e=s.object.position;return o.copy(e).sub(s.target),o.applyQuaternion(n),m.setFromVector3(o),s.autoRotate&&h===u.NONE&&T(2*Math.PI/60/60*s.autoRotateSpeed),m.theta+=f.theta,m.phi+=f.phi,m.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=v,m.radius=Math.max(s.minDistance,Math.min(s.maxDistance,m.radius)),s.target.add(b),o.setFromSpherical(m),o.applyQuaternion(r),e.copy(s.target).add(o),s.object.lookAt(s.target),!0===s.enableDamping?(f.theta*=1-s.dampingFactor,f.phi*=1-s.dampingFactor,b.multiplyScalar(1-s.dampingFactor)):(f.set(0,0,0),b.set(0,0,0)),v=1,!(!(y||i.distanceToSquared(s.object.position)>d||8*(1-a.dot(s.object.quaternion))>d)||(s.dispatchEvent(c),i.copy(s.object.position),a.copy(s.object.quaternion),y=!1))}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",G,!1),s.domElement.removeEventListener("mousedown",I,!1),s.domElement.removeEventListener("wheel",U,!1),s.domElement.removeEventListener("touchstart",W,!1),s.domElement.removeEventListener("touchend",Z,!1),s.domElement.removeEventListener("touchmove",X,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",$,!1),window.removeEventListener("keydown",Y,!1)};var s=this,c={type:"change"},l={type:"start"},p={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},h=u.NONE,d=1e-6,m=new B.Spherical,f=new B.Spherical,v=1,b=new B.Vector3,y=!1,g=new B.Vector2,w=new B.Vector2,x=new B.Vector2,E=new B.Vector2,_=new B.Vector2,M=new B.Vector2,C=new B.Vector2,j=new B.Vector2,O=new B.Vector2;function S(){return Math.pow(.95,s.zoomSpeed)}function T(e){f.theta-=e}function V(e){f.phi-=e}var P,L,R,z=(P=new B.Vector3,function(e,t){P.setFromMatrixColumn(t,0),P.multiplyScalar(-e),b.add(P)}),k=(L=new B.Vector3,function(e,t){!0===s.screenSpacePanning?L.setFromMatrixColumn(t,1):(L.setFromMatrixColumn(t,0),L.crossVectors(s.object.up,L)),L.multiplyScalar(e),b.add(L)}),D=(R=new B.Vector3,function(e,t){var o=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;R.copy(n).sub(s.target);var r=R.length();r*=Math.tan(s.object.fov/2*Math.PI/180),z(2*e*r/o.clientHeight,s.object.matrix),k(2*t*r/o.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(z(e*(s.object.right-s.object.left)/s.object.zoom/o.clientWidth,s.object.matrix),k(t*(s.object.top-s.object.bottom)/s.object.zoom/o.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)});function H(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function A(e){E.set(e.clientX,e.clientY)}function I(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===s.enablePan)return;A(e),h=u.PAN}else{if(!1===s.enableRotate)return;o=e,g.set(o.clientX,o.clientY),h=u.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;t=e,C.set(t.clientX,t.clientY),h=u.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;A(e),h=u.PAN}var t,o;h!==u.NONE&&(document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",$,!1),s.dispatchEvent(l))}}function F(e){var t,o;if(!1!==s.enabled)switch(e.preventDefault(),h){case u.ROTATE:if(!1===s.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),x.subVectors(w,g).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;T(2*Math.PI*x.x/t.clientHeight),V(2*Math.PI*x.y/t.clientHeight),g.copy(w),s.update()}(e);break;case u.DOLLY:if(!1===s.enableZoom)return;o=e,j.set(o.clientX,o.clientY),O.subVectors(j,C),0<O.y?H(S()):O.y<0&&N(S()),C.copy(j),s.update();break;case u.PAN:if(!1===s.enablePan)return;t=e,_.set(t.clientX,t.clientY),M.subVectors(_,E).multiplyScalar(s.panSpeed),D(M.x,M.y),E.copy(_),s.update()}}function $(e){!1!==s.enabled&&(document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",$,!1),s.dispatchEvent(p),h=u.NONE)}function U(e){var t;!1===s.enabled||!1===s.enableZoom||h!==u.NONE&&h!==u.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(l),(t=e).deltaY<0?N(S()):0<t.deltaY&&H(S()),s.update(),s.dispatchEvent(p))}function Y(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:D(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:D(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:D(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:D(-s.keyPanSpeed,0),s.update()}}(e)}function W(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;t=e,g.set(t.touches[0].pageX,t.touches[0].pageY),h=u.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);C.set(0,n)}if(s.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(r,i)}}(e),h=u.TOUCH_DOLLY_PAN;break;default:h=u.NONE}var t;h!==u.NONE&&s.dispatchEvent(l)}}function X(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(h!==u.TOUCH_ROTATE)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(w,g).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;T(2*Math.PI*x.x/t.clientHeight),V(2*Math.PI*x.y/t.clientHeight),g.copy(w),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(h!==u.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);j.set(0,n),O.set(0,Math.pow(j.y/C.y,s.zoomSpeed)),H(O.y),C.copy(j)}if(s.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(r,i),M.subVectors(_,E).multiplyScalar(s.panSpeed),D(M.x,M.y),E.copy(_)}s.update()}(e);break;default:h=u.NONE}}function Z(e){!1!==s.enabled&&(s.dispatchEvent(p),h=u.NONE)}function G(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",G,!1),s.domElement.addEventListener("mousedown",I,!1),s.domElement.addEventListener("wheel",U,!1),s.domElement.addEventListener("touchstart",W,!1),s.domElement.addEventListener("touchend",Z,!1),s.domElement.addEventListener("touchmove",X,!1),window.addEventListener("keydown",Y,!1),this.update()},B.OrbitControls.prototype=Object.create(B.EventDispatcher.prototype),B.OrbitControls.prototype.constructor=B.OrbitControls,Object.defineProperties(B.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),B.OrbitControls}),define("Viewport",["three","lodash","backbone","cmd","core/loop/RenderingLoop","core/PointerRay","core/Domevents","json!core/viewport/model.json","vendor/three/controls/OrbitControls"],function(a,s,e,c,l,p,u,t){var h={$vp:window,antialias:"default",renderer:"standard",postprocessing:!1,shadowMap:!0,clearColor:"lightgrey",alpha:!0,opacity:.5,camFov:45},d=e.Model.extend({defaults:s.extend({},t.defaults,{$vp:window}),bounds:t.bounds}),o=function(e){var t,o,n,r,i;c.createControl("VP"),c.createControl("Scene"),c.createControl("Camera"),this.options=s.extend({},h,e),this.model=new d,this.clock=new a.Clock,this.model.on("change:camControl",function(){this.control.enabled=this.model.attributes.camControl},this),c.VP.on("disableControl",this.disableControl,this),c.VP.on("enableControl",this.enableControl,this),this.renderer=(o=null,n="default"===(t=this).options.antialias,"deferred"===t.options.renderer?o=new a.WebGLDeferredRenderer({antialias:t.options.antialias,tonemapping:a.FilmicOperator,brightness:2.5,scale:1,width:t.options.$vp.innerWidth,height:t.options.$vp.innerHeight}):((o=new a.WebGLRenderer({alpha:!0,antialias:n})).setSize(t.options.$vp.innerWidth,t.options.$vp.innerHeight),o.shadowMap.enabled=t.options.shadowMap,o.shadowMapSoft=!0,o.setClearColor(new a.Color(t.options.clearColor),t.options.opacity)),o),c.trigger("rendererInitalized",this),this.scene=this.options.scene||new a.Scene,c.trigger("sceneInitalized",this),this.camera=(r=this).options.camera||new a.PerspectiveCamera(r.options.camFov,r.options.$vp.innerWidth/r.options.$vp.innerHeight,1,2e4),c.trigger("cameraInitalized",this),this.options.effect&&a[this.options.effect]?effect=new a[this.options.effect](this.renderer):this.options.effect=!1,this.scene.add(this.camera),h.$vp===window||this.options.$vp[0]===window?document.body.appendChild(this.renderer.domElement):this.options.$vp.append(this.renderer.domElement),(i=this).loop=new l,i.options.postprocessing?i.loop.add(function(){i.scene.overrideMaterial=i.depthMaterial,i.renderer.render(i.scene,i.camera,i.depthRenderTarget,!0),i.scene.overrideMaterial=null,i.composer.render()}):i.options.effect?i.loop.add(function(){i.effect.render(i.scene,i.camera)}):i.loop.add(function(){i.renderer.render(i.scene,i.camera)}),this.scene.addEventListener("update",function(){}.bind(this)),this.DomEvents=new u(this.camera,this.renderer.domElement),this.control=this.options.control||new a.OrbitControls(this.camera,document),this.options.postprocessing,this.raycaster=new p(this),c.trigger("viewportInitalized",this)};return o.prototype.init=function(){c.VP.trigger("initalized",this)},o.prototype.start=function(){this.DomEvents.addEventListener(this.scene,"click",this.onClick.bind(this)),this.clock.getDelta(),this.loop.start(),c.VP.trigger("started",this)},o.prototype.stop=function(){this.loop.stop(),c.VP.trigger("started",this)},o.prototype.disableControl=function(){this.control.enabled=!1},o.prototype.enableControl=function(){this.control.enabled=!0},o.prototype.onClick=function(e){},o});
define("core/loop/Loop",["lodash"],function(e){var t=function(){this._fcts=[]};return t.prototype.add=function(e){return this._fcts.push(e),e},t.prototype.remove=function(e){var t=this._fcts.indexOf(e);-1!==t&&this._fcts.splice(t,1)},t.prototype.update=function(t){e.each(this._fcts,function(e){e(t)})},t}),define("core/loop/RenderingLoop",["core/loop/Loop","lodash"],function(e,t){var o=function(){e.call(this),this.maxDelta=.2;var o=null,n=null,r=function(e){o=requestAnimationFrame(r),n=n||e-1e3/60;var t=Math.min(1e3*this.maxDelta,e-n);n=e,this.update(t/1e3)}.bind(this);this.start=function(){console.assert(!1===this.isRunning()),o=requestAnimationFrame(r)},this.isRunning=function(){return!!o},this.stop=function(){null!==o&&(cancelAnimationFrame(o),o=null)}};return o.prototype=t.create(e.prototype,{constructor:o}),o}),define("core/PointerRay",["three"],function(e){var o=new e.Raycaster,n=new e.Vector2;return function(t){this.getRay=function(e){return n.set(e.clientX/window.innerWidth*2-1,-e.clientY/window.innerHeight*2+1),o.setFromCamera(n,t.camera),o.ray}}}),define("vendor/three/renderers/Projector",["three"],function(xe){return xe.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},xe.RenderableFace=function(){this.id=0,this.v1=new xe.RenderableVertex,this.v2=new xe.RenderableVertex,this.v3=new xe.RenderableVertex,this.normalModel=new xe.Vector3,this.vertexNormalsModel=[new xe.Vector3,new xe.Vector3,new xe.Vector3],this.vertexNormalsLength=0,this.color=new xe.Color,this.material=null,this.uvs=[new xe.Vector2,new xe.Vector2,new xe.Vector2],this.z=0,this.renderOrder=0},xe.RenderableVertex=function(){this.position=new xe.Vector3,this.positionWorld=new xe.Vector3,this.positionScreen=new xe.Vector4,this.visible=!0},xe.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},xe.RenderableLine=function(){this.id=0,this.v1=new xe.RenderableVertex,this.v2=new xe.RenderableVertex,this.vertexColors=[new xe.Color,new xe.Color],this.material=null,this.z=0,this.renderOrder=0},xe.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new xe.Vector2,this.material=null,this.renderOrder=0},xe.Projector=function(){var t,B,i,K,q,Q,J,ee,r,te,oe,o=[],n=0,ne=[],a=0,s=[],c=0,l=[],p=0,u=[],h=0,re={objects:[],lights:[],elements:[]},ie=new xe.Vector3,ae=new xe.Vector4,f=new xe.Box3(new xe.Vector3(-1,-1,-1),new xe.Vector3(1,1,1)),v=new xe.Box3,b=new Array(3),se=new xe.Matrix4,ce=new xe.Matrix4,le=new xe.Matrix4,pe=new xe.Matrix3,ue=new xe.Frustum,he=new xe.Vector4,de=new xe.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var me=new function(){var l=[],r=[],p=[],u=null,h=new xe.Matrix3;function n(e){var t=e.position,o=e.positionWorld,n=e.positionScreen;o.copy(t).applyMatrix4(oe),n.copy(o).applyMatrix4(ce);var r=1/n.w;n.x*=r,n.y*=r,n.z*=r,e.visible=-1<=n.x&&n.x<=1&&-1<=n.y&&n.y<=1&&-1<=n.z&&n.z<=1}function d(e,t,o){return!0===e.visible||!0===t.visible||!0===o.visible||(b[0]=e.positionScreen,b[1]=t.positionScreen,b[2]=o.positionScreen,f.intersectsBox(v.setFromPoints(b)))}function m(e,t,o){return(o.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(o.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){(u=e).material,h.getNormalMatrix(u.matrixWorld),l.length=0,r.length=0,p.length=0},projectVertex:n,checkTriangleVisibility:d,checkBackfaceCulling:m,pushVertex:function(e,t,o){(i=be()).position.set(e,t,o),n(i)},pushNormal:function(e,t,o){l.push(e,t,o)},pushColor:function(e,t,o){r.push(e,t,o)},pushUv:function(e,t){p.push(e,t)},pushLine:function(e,t){var o=ne[e],n=ne[t];o.positionScreen.copy(o.position).applyMatrix4(le),n.positionScreen.copy(n.position).applyMatrix4(le),!0===Ee(o.positionScreen,n.positionScreen)&&(o.positionScreen.multiplyScalar(1/o.positionScreen.w),n.positionScreen.multiplyScalar(1/n.positionScreen.w),(J=ge()).id=u.id,J.v1.copy(o),J.v2.copy(n),J.z=Math.max(o.positionScreen.z,n.positionScreen.z),J.renderOrder=u.renderOrder,J.material=u.material,u.material.vertexColors===xe.VertexColors&&(J.vertexColors[0].fromArray(r,3*e),J.vertexColors[1].fromArray(r,3*t)),re.elements.push(J))},pushTriangle:function(e,t,o,n){var r=ne[e],i=ne[t],a=ne[o];if(!1!==d(r,i,a)&&(n.side===xe.DoubleSide||!0===m(r,i,a))){(q=ye()).id=u.id,q.v1.copy(r),q.v2.copy(i),q.v3.copy(a),q.z=(r.positionScreen.z+i.positionScreen.z+a.positionScreen.z)/3,q.renderOrder=u.renderOrder,ie.subVectors(a.position,i.position),ae.subVectors(r.position,i.position),ie.cross(ae),q.normalModel.copy(ie),q.normalModel.applyMatrix3(h).normalize();for(var s=0;s<3;s++){var c=q.vertexNormalsModel[s];c.fromArray(l,3*arguments[s]),c.applyMatrix3(h).normalize(),q.uvs[s].fromArray(p,2*arguments[s])}q.vertexNormalsLength=3,q.material=n,re.elements.push(q)}}}};function fe(e){(t=function(){if(B===n){var e=new xe.RenderableObject;return o.push(e),n++,B++,e}return o[B++]}()).id=e.id,t.object=e,ie.setFromMatrixPosition(e.matrixWorld),ie.applyMatrix4(ce),t.z=ie.z,t.renderOrder=e.renderOrder,re.objects.push(t)}function ve(e,t,o){var n=1/e.w;e.z*=n,-1<=e.z&&e.z<=1&&((r=function(){if(te===h){var e=new xe.RenderableSprite;return u.push(e),h++,te++,e}return u[te++]}()).id=t.id,r.x=e.x*n,r.y=e.y*n,r.z=e.z,r.renderOrder=t.renderOrder,r.object=t,r.rotation=t.rotation,r.scale.x=t.scale.x*Math.abs(r.x-(e.x+o.projectionMatrix.elements[0])/(e.w+o.projectionMatrix.elements[12])),r.scale.y=t.scale.y*Math.abs(r.y-(e.y+o.projectionMatrix.elements[5])/(e.w+o.projectionMatrix.elements[13])),r.material=t.material,re.elements.push(r))}function be(){if(K===a){var e=new xe.RenderableVertex;return ne.push(e),a++,K++,e}return ne[K++]}function ye(){if(Q===c){var e=new xe.RenderableFace;return s.push(e),c++,Q++,e}return s[Q++]}function ge(){if(ee===p){var e=new xe.RenderableLine;return l.push(e),p++,ee++,e}return l[ee++]}function we(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function Ee(e,t){var o=0,n=1,r=e.z+e.w,i=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return 0<=r&&0<=i&&0<=a&&0<=s||!(r<0&&i<0||a<0&&s<0)&&(r<0?o=Math.max(o,r/(r-i)):i<0&&(n=Math.min(n,r/(r-i))),a<0?o=Math.max(o,a/(a-s)):s<0&&(n=Math.min(n,a/(a-s))),!(n<o)&&(e.lerp(t,o),t.lerp(e,1-n),!0))}this.projectScene=function(e,t,o,n){te=ee=Q=0,!(re.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),se.copy(t.matrixWorldInverse),ce.multiplyMatrices(t.projectionMatrix,se),ue.setFromMatrix(ce),B=0,re.objects.length=0,re.lights.length=0,function e(t){if(!1!==t.visible){if(t instanceof xe.Light)re.lights.push(t);else if(t instanceof xe.Mesh||t instanceof xe.Line||t instanceof xe.Points){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===ue.intersectsObject(t))return;fe(t)}else if(t instanceof xe.Sprite){if(!1===t.material.visible)return;if(!0===t.frustumCulled&&!1===ue.intersectsSprite(t))return;fe(t)}for(var o=t.children,n=0,r=o.length;n<r;n++)e(o[n])}}(e),!0===o&&re.objects.sort(we);for(var r=re.objects,i=0,a=r.length;i<a;i++){var s=r[i].object,c=s.geometry;if(me.setObject(s),oe=s.matrixWorld,K=0,s instanceof xe.Mesh){if(c instanceof xe.BufferGeometry){var l=s.material,p=Array.isArray(l),u=c.attributes,h=c.groups;if(void 0===u.position)continue;for(var d=0,m=(Z=u.position.array).length;d<m;d+=3)me.pushVertex(Z[d],Z[d+1],Z[d+2]);if(void 0!==u.normal){var f=u.normal.array;for(d=0,m=f.length;d<m;d+=3)me.pushNormal(f[d],f[d+1],f[d+2])}if(void 0!==u.uv){var v=u.uv.array;for(d=0,m=v.length;d<m;d+=2)me.pushUv(v[d],v[d+1])}if(null!==c.index){var b=c.index.array;if(0<h.length)for(var y=0;y<h.length;y++){var g=h[y];if(void 0!==(l=!0===p?s.material[g.materialIndex]:s.material))for(d=g.start,m=g.start+g.count;d<m;d+=3)me.pushTriangle(b[d],b[d+1],b[d+2],l)}else for(d=0,m=b.length;d<m;d+=3)me.pushTriangle(b[d],b[d+1],b[d+2],l)}else if(0<h.length)for(y=0;y<h.length;y++){g=h[y];if(void 0!==(l=!0===p?s.material[g.materialIndex]:s.material))for(d=g.start,m=g.start+g.count;d<m;d+=3)me.pushTriangle(d,d+1,d+2,l)}else for(d=0,m=Z.length/3;d<m;d+=3)me.pushTriangle(d,d+1,d+2,l)}else if(c instanceof xe.Geometry){var w=c.vertices,E=c.faces,x=c.faceVertexUvs[0];pe.getNormalMatrix(oe);l=s.material,p=Array.isArray(l);for(var _=0,M=w.length;_<M;_++){var C=w[_];if(ie.copy(C),!0===l.morphTargets)for(var j=c.morphTargets,O=s.morphTargetInfluences,S=0,P=j.length;S<P;S++){var L=O[S];if(0!==L){var T=j[S].vertices[_];ie.x+=(T.x-C.x)*L,ie.y+=(T.y-C.y)*L,ie.z+=(T.z-C.z)*L}}me.pushVertex(ie.x,ie.y,ie.z)}for(var V=0,R=E.length;V<R;V++){var z=E[V];if(void 0!==(l=!0===p?s.material[z.materialIndex]:s.material)){var k=l.side,D=ne[z.a],H=ne[z.b],N=ne[z.c];if(!1!==me.checkTriangleVisibility(D,H,N)){var A=me.checkBackfaceCulling(D,H,N);if(k!==xe.DoubleSide){if(k===xe.FrontSide&&!1===A)continue;if(k===xe.BackSide&&!0===A)continue}(q=ye()).id=s.id,q.v1.copy(D),q.v2.copy(H),q.v3.copy(N),q.normalModel.copy(z.normal),!1!==A||k!==xe.BackSide&&k!==xe.DoubleSide||q.normalModel.negate(),q.normalModel.applyMatrix3(pe).normalize();for(var I=z.vertexNormals,F=0,$=Math.min(I.length,3);F<$;F++){var U=q.vertexNormalsModel[F];U.copy(I[F]),!1!==A||k!==xe.BackSide&&k!==xe.DoubleSide||U.negate(),U.applyMatrix3(pe).normalize()}q.vertexNormalsLength=I.length;var Y=x[V];if(void 0!==Y)for(var W=0;W<3;W++)q.uvs[W].copy(Y[W]);q.color=z.color,q.material=l,q.z=(D.positionScreen.z+H.positionScreen.z+N.positionScreen.z)/3,q.renderOrder=s.renderOrder,re.elements.push(q)}}}}}else if(s instanceof xe.Line){if(le.multiplyMatrices(ce,oe),c instanceof xe.BufferGeometry){if(void 0!==(u=c.attributes).position){for(d=0,m=(Z=u.position.array).length;d<m;d+=3)me.pushVertex(Z[d],Z[d+1],Z[d+2]);if(void 0!==u.color){var G=u.color.array;for(d=0,m=G.length;d<m;d+=3)me.pushColor(G[d],G[d+1],G[d+2])}if(null!==c.index)for(d=0,m=(b=c.index.array).length;d<m;d+=2)me.pushLine(b[d],b[d+1]);else{var X=s instanceof xe.LineSegments?2:1;for(d=0,m=Z.length/3-1;d<m;d+=X)me.pushLine(d,d+1)}}}else if(c instanceof xe.Geometry){if(0===(w=s.geometry.vertices).length)continue;(D=be()).positionScreen.copy(w[0]).applyMatrix4(le);for(X=s instanceof xe.LineSegments?2:1,_=1,M=w.length;_<M;_++)(D=be()).positionScreen.copy(w[_]).applyMatrix4(le),0<(_+1)%X||(H=ne[K-2],he.copy(D.positionScreen),de.copy(H.positionScreen),!0===Ee(he,de)&&(he.multiplyScalar(1/he.w),de.multiplyScalar(1/de.w),(J=ge()).id=s.id,J.v1.positionScreen.copy(he),J.v2.positionScreen.copy(de),J.z=Math.max(he.z,de.z),J.renderOrder=s.renderOrder,J.material=s.material,s.material.vertexColors===xe.VertexColors&&(J.vertexColors[0].copy(s.geometry.colors[_]),J.vertexColors[1].copy(s.geometry.colors[_-1])),re.elements.push(J)))}}else if(s instanceof xe.Points){if(le.multiplyMatrices(ce,oe),c instanceof xe.Geometry)for(_=0,M=(w=s.geometry.vertices).length;_<M;_++){C=w[_];ae.set(C.x,C.y,C.z,1),ae.applyMatrix4(le),ve(ae,s,t)}else if(c instanceof xe.BufferGeometry){if(void 0!==(u=c.attributes).position){var Z;for(d=0,m=(Z=u.position.array).length;d<m;d+=3)ae.set(Z[d],Z[d+1],Z[d+2],1),ae.applyMatrix4(le),ve(ae,s,t)}}}else s instanceof xe.Sprite&&(ae.set(oe.elements[12],oe.elements[13],oe.elements[14],1),ae.applyMatrix4(ce),ve(ae,s,t))}return!0===n&&re.elements.sort(we),re}},xe.Projector}),define("core/Domevents",["three","vendor/three/renderers/Projector"],function(f){var l=function(e,t){this._camera=e||null,this._domElement=t||document,this._projector=new f.Projector,this._selected=null,this._boundObjs={};var o=this;this._$onClick=function(){o._onClick.apply(o,arguments)},this._$onDblClick=function(){o._onDblClick.apply(o,arguments)},this._$onMouseMove=function(){o._onMouseMove.apply(o,arguments)},this._$onMouseDown=function(){o._onMouseDown.apply(o,arguments)},this._$onMouseUp=function(){o._onMouseUp.apply(o,arguments)},this._$onTouchMove=function(){o._onTouchMove.apply(o,arguments)},this._$onTouchStart=function(){o._onTouchStart.apply(o,arguments)},this._$onTouchEnd=function(){o._onTouchEnd.apply(o,arguments)},this._$onContextmenu=function(){o._onContextmenu.apply(o,arguments)},this._domElement.addEventListener("click",this._$onClick,!1),this._domElement.addEventListener("dblclick",this._$onDblClick,!1),this._domElement.addEventListener("mousemove",this._$onMouseMove,!1),this._domElement.addEventListener("mousedown",this._$onMouseDown,!1),this._domElement.addEventListener("mouseup",this._$onMouseUp,!1),this._domElement.addEventListener("touchmove",this._$onTouchMove,!1),this._domElement.addEventListener("touchstart",this._$onTouchStart,!1),this._domElement.addEventListener("touchend",this._$onTouchEnd,!1),this._domElement.addEventListener("contextmenu",this._$onContextmenu,!1)};return l.prototype.destroy=function(){this._domElement.removeEventListener("click",this._$onClick,!1),this._domElement.removeEventListener("dblclick",this._$onDblClick,!1),this._domElement.removeEventListener("mousemove",this._$onMouseMove,!1),this._domElement.removeEventListener("mousedown",this._$onMouseDown,!1),this._domElement.removeEventListener("mouseup",this._$onMouseUp,!1),this._domElement.removeEventListener("touchmove",this._$onTouchMove,!1),this._domElement.removeEventListener("touchstart",this._$onTouchStart,!1),this._domElement.removeEventListener("touchend",this._$onTouchEnd,!1),this._domElement.removeEventListener("contextmenu",this._$onContextmenu,!1)},l.eventNames=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],l.prototype._getRelativeMouseXY=function(e){var t=e.target||e.srcElement;3===t.nodeType&&(t=t.parentNode);var o={x:0,y:0},n=t,r=getComputedStyle(n,null);for(o.y+=parseInt(r.getPropertyValue("padding-top"),10),o.x+=parseInt(r.getPropertyValue("padding-left"),10);o.x+=n.offsetLeft,o.y+=n.offsetTop,r=getComputedStyle(n,null),o.x+=parseInt(r.getPropertyValue("border-left-width"),10),o.y+=parseInt(r.getPropertyValue("border-top-width"),10),n=n.offsetParent;);var i=t===window?window.innerWidth:t.offsetWidth,a=t===window?window.innerHeight:t.offsetHeight;return{x:+(e.pageX-o.x)/i*2-1,y:-(e.pageY-o.y)/a*2+1}},l.prototype._objectCtxInit=function(e){e._3xDomEvent={}},l.prototype._objectCtxDeinit=function(e){delete e._3xDomEvent},l.prototype._objectCtxIsInit=function(e){return!!e._3xDomEvent},l.prototype._objectCtxGet=function(e){return e._3xDomEvent},l.prototype.camera=function(e){return e&&(this._camera=e),this._camera},l.prototype.addEventListener=l.prototype.bind=function(e,t,o,n){console.assert(-1!==l.eventNames.indexOf(t),"not available events:"+t),this._objectCtxIsInit(e)||this._objectCtxInit(e);var r=this._objectCtxGet(e);r[t+"Handlers"]||(r[t+"Handlers"]=[]),r[t+"Handlers"].push({callback:o,useCapture:n}),void 0===this._boundObjs[t]&&(this._boundObjs[t]=[]),this._boundObjs[t].push(e)},l.prototype.removeEventListener=l.prototype.unbind=function(e,t,o,n){console.assert(-1!==l.eventNames.indexOf(t),"not available events:"+t),this._objectCtxIsInit(e)||this._objectCtxInit(e);var r=this._objectCtxGet(e);r[t+"Handlers"]||(r[t+"Handlers"]=[]);for(var i=r[t+"Handlers"],a=0;a<i.length;a++){var s=i[a];if(o==s.callback&&n==s.useCapture){i.splice(a,1);break}}var c=this._boundObjs[t].indexOf(e);console.assert(-1!==c),this._boundObjs[t].splice(c,1)},l.prototype._bound=function(e,t){var o=this._objectCtxGet(t);return!!o&&!!o[e+"Handlers"]},l.prototype._onMove=function(e,t,o,n){var r=this._boundObjs[e];if(void 0!==r&&0!==r.length){var i=new f.Vector3,a=new f.Raycaster,s=new f.Vector3;this._camera instanceof f.OrthographicCamera?(i.set(t,o,-1),i.unproject(this._camera),s.set(0,0,-1).transformDirection(this._camera.matrixWorld),a.set(i,s)):this._camera instanceof f.PerspectiveCamera&&(i.set(t,o,.5),i.unproject(this._camera),a.set(this._camera.position,i.sub(this._camera.position).normalize()));var c=a.intersectObjects(r),l=this._selected;if(0<c.length){var p,u,h,d=c[0],m=d.object;this._selected=m,h=this._bound("mousemove",m),l!=m&&(p=this._bound("mouseover",m),u=l&&this._bound("mouseout",l))}else u=l&&this._bound("mouseout",l),this._selected=null;h&&this._notify("mousemove",m,n,d),p&&this._notify("mouseover",m,n,d),u&&this._notify("mouseout",l,n,d)}},l.prototype._onEvent=function(e,t,o,n){var r=this._boundObjs[e];if(void 0!==r&&0!==r.length){var i=new f.Vector3,a=new f.Raycaster,s=new f.Vector3;this._camera instanceof f.OrthographicCamera?(i.set(t,o,-1),i.unproject(this._camera),s.set(0,0,-1).transformDirection(this._camera.matrixWorld),a.set(i,s)):this._camera instanceof f.PerspectiveCamera&&(i.set(t,o,.5),i.unproject(this._camera),a.set(this._camera.position,i.sub(this._camera.position).normalize()));var c=a.intersectObjects(r,!0);if(0!==c.length){for(var l=c[0],p=l.object,u=this._objectCtxGet(p),h=p.parent;void 0===u&&h;)u=this._objectCtxGet(h),h=h.parent;u&&this._notify(e,p,n,l)}}},l.prototype._notify=function(e,t,o,n){var r=this._objectCtxGet(t),i=r?r[e+"Handlers"]:null;if(console.assert(4===arguments.length),r&&i&&0!==i.length){i=r[e+"Handlers"];for(var a=0;a<i.length;a++){var s=i[a],c=!0;s.callback({type:e,target:t,origDomEvent:o,intersect:n,stopPropagation:function(){c=!1}}),c&&(!1===s.useCapture&&t.parent&&this._notify(e,t.parent,o,n))}}else t.parent&&this._notify(e,t.parent,o,n)},l.prototype._onMouseDown=function(e){return this._onMouseEvent("mousedown",e)},l.prototype._onMouseUp=function(e){return this._onMouseEvent("mouseup",e)},l.prototype._onMouseEvent=function(e,t){var o=this._getRelativeMouseXY(t);this._onEvent(e,o.x,o.y,t)},l.prototype._onMouseMove=function(e){var t=this._getRelativeMouseXY(e);this._onMove("mousemove",t.x,t.y,e),this._onMove("mouseover",t.x,t.y,e),this._onMove("mouseout",t.x,t.y,e)},l.prototype._onClick=function(e){this._onMouseEvent("click",e)},l.prototype._onDblClick=function(e){this._onMouseEvent("dblclick",e)},l.prototype._onContextmenu=function(e){this._onMouseEvent("contextmenu",e)},l.prototype._onTouchStart=function(e){return this._onTouchEvent("mousedown",e)},l.prototype._onTouchEnd=function(e){return this._onTouchEvent("mouseup",e)},l.prototype._onTouchMove=function(e){if(1==e.touches.length){e.preventDefault();var t=+e.touches[0].pageX/window.innerWidth*2-1,o=-e.touches[0].pageY/window.innerHeight*2+1;this._onMove("mousemove",t,o,e),this._onMove("mouseover",t,o,e),this._onMove("mouseout",t,o,e)}},l.prototype._onTouchEvent=function(e,t){if(1==t.touches.length){t.preventDefault();var o=+t.touches[0].pageX/window.innerWidth*2-1,n=-t.touches[0].pageY/window.innerHeight*2+1;this._onEvent(e,o,n,t)}},l}),define("json!core/viewport/model.json",function(){return{defaults:{antialias:"default",renderer:"standard",postprocessing:!1,shadowMap:!0,clearColor:"lightgrey",alpha:!0,opacity:.5,camFov:45,camControl:!0},bounds:{antialias:{list:["none","default","fxaa","smaa"],type:"array"},renderer:{list:["deferred","standard"],type:"array"},camControl:{type:"boolean"}}}}),define("vendor/three/controls/OrbitControls",["three"],function(B){return B.OrbitControls=function(e,t){var o,n,r,i,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new B.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:B.MOUSE.LEFT,MIDDLE:B.MOUSE.MIDDLE,RIGHT:B.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return m.phi},this.getAzimuthalAngle=function(){return m.theta},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(c),s.update(),h=u.NONE},this.update=(o=new B.Vector3,n=(new B.Quaternion).setFromUnitVectors(e.up,new B.Vector3(0,1,0)),r=n.clone().inverse(),i=new B.Vector3,a=new B.Quaternion,function(){var e=s.object.position;return o.copy(e).sub(s.target),o.applyQuaternion(n),m.setFromVector3(o),s.autoRotate&&h===u.NONE&&P(2*Math.PI/60/60*s.autoRotateSpeed),m.theta+=f.theta,m.phi+=f.phi,m.theta=Math.max(s.minAzimuthAngle,Math.min(s.maxAzimuthAngle,m.theta)),m.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,m.phi)),m.makeSafe(),m.radius*=v,m.radius=Math.max(s.minDistance,Math.min(s.maxDistance,m.radius)),s.target.add(b),o.setFromSpherical(m),o.applyQuaternion(r),e.copy(s.target).add(o),s.object.lookAt(s.target),!0===s.enableDamping?(f.theta*=1-s.dampingFactor,f.phi*=1-s.dampingFactor,b.multiplyScalar(1-s.dampingFactor)):(f.set(0,0,0),b.set(0,0,0)),v=1,!(!(y||i.distanceToSquared(s.object.position)>d||8*(1-a.dot(s.object.quaternion))>d)||(s.dispatchEvent(c),i.copy(s.object.position),a.copy(s.object.quaternion),y=!1))}),this.dispose=function(){s.domElement.removeEventListener("contextmenu",Z,!1),s.domElement.removeEventListener("mousedown",I,!1),s.domElement.removeEventListener("wheel",U,!1),s.domElement.removeEventListener("touchstart",W,!1),s.domElement.removeEventListener("touchend",X,!1),s.domElement.removeEventListener("touchmove",G,!1),document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",$,!1),window.removeEventListener("keydown",Y,!1)};var s=this,c={type:"change"},l={type:"start"},p={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},h=u.NONE,d=1e-6,m=new B.Spherical,f=new B.Spherical,v=1,b=new B.Vector3,y=!1,g=new B.Vector2,w=new B.Vector2,E=new B.Vector2,x=new B.Vector2,_=new B.Vector2,M=new B.Vector2,C=new B.Vector2,j=new B.Vector2,O=new B.Vector2;function S(){return Math.pow(.95,s.zoomSpeed)}function P(e){f.theta-=e}function L(e){f.phi-=e}var T,V,R,z=(T=new B.Vector3,function(e,t){T.setFromMatrixColumn(t,0),T.multiplyScalar(-e),b.add(T)}),k=(V=new B.Vector3,function(e,t){!0===s.screenSpacePanning?V.setFromMatrixColumn(t,1):(V.setFromMatrixColumn(t,0),V.crossVectors(s.object.up,V)),V.multiplyScalar(e),b.add(V)}),D=(R=new B.Vector3,function(e,t){var o=s.domElement===document?s.domElement.body:s.domElement;if(s.object.isPerspectiveCamera){var n=s.object.position;R.copy(n).sub(s.target);var r=R.length();r*=Math.tan(s.object.fov/2*Math.PI/180),z(2*e*r/o.clientHeight,s.object.matrix),k(2*t*r/o.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(z(e*(s.object.right-s.object.left)/s.object.zoom/o.clientWidth,s.object.matrix),k(t*(s.object.top-s.object.bottom)/s.object.zoom/o.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)});function H(e){s.object.isPerspectiveCamera?v/=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function N(e){s.object.isPerspectiveCamera?v*=e:s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/e)),s.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function A(e){x.set(e.clientX,e.clientY)}function I(e){if(!1!==s.enabled){switch(e.preventDefault(),e.button){case s.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey){if(!1===s.enablePan)return;A(e),h=u.PAN}else{if(!1===s.enableRotate)return;o=e,g.set(o.clientX,o.clientY),h=u.ROTATE}break;case s.mouseButtons.MIDDLE:if(!1===s.enableZoom)return;t=e,C.set(t.clientX,t.clientY),h=u.DOLLY;break;case s.mouseButtons.RIGHT:if(!1===s.enablePan)return;A(e),h=u.PAN}var t,o;h!==u.NONE&&(document.addEventListener("mousemove",F,!1),document.addEventListener("mouseup",$,!1),s.dispatchEvent(l))}}function F(e){var t,o;if(!1!==s.enabled)switch(e.preventDefault(),h){case u.ROTATE:if(!1===s.enableRotate)return;!function(e){w.set(e.clientX,e.clientY),E.subVectors(w,g).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*E.x/t.clientHeight),L(2*Math.PI*E.y/t.clientHeight),g.copy(w),s.update()}(e);break;case u.DOLLY:if(!1===s.enableZoom)return;o=e,j.set(o.clientX,o.clientY),O.subVectors(j,C),0<O.y?H(S()):O.y<0&&N(S()),C.copy(j),s.update();break;case u.PAN:if(!1===s.enablePan)return;t=e,_.set(t.clientX,t.clientY),M.subVectors(_,x).multiplyScalar(s.panSpeed),D(M.x,M.y),x.copy(_),s.update()}}function $(e){!1!==s.enabled&&(document.removeEventListener("mousemove",F,!1),document.removeEventListener("mouseup",$,!1),s.dispatchEvent(p),h=u.NONE)}function U(e){var t;!1===s.enabled||!1===s.enableZoom||h!==u.NONE&&h!==u.ROTATE||(e.preventDefault(),e.stopPropagation(),s.dispatchEvent(l),(t=e).deltaY<0?N(S()):0<t.deltaY&&H(S()),s.update(),s.dispatchEvent(p))}function Y(e){!1!==s.enabled&&!1!==s.enableKeys&&!1!==s.enablePan&&function(e){switch(e.keyCode){case s.keys.UP:D(0,s.keyPanSpeed),s.update();break;case s.keys.BOTTOM:D(0,-s.keyPanSpeed),s.update();break;case s.keys.LEFT:D(s.keyPanSpeed,0),s.update();break;case s.keys.RIGHT:D(-s.keyPanSpeed,0),s.update()}}(e)}function W(e){if(!1!==s.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===s.enableRotate)return;t=e,g.set(t.touches[0].pageX,t.touches[0].pageY),h=u.TOUCH_ROTATE;break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);C.set(0,n)}if(s.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);x.set(r,i)}}(e),h=u.TOUCH_DOLLY_PAN;break;default:h=u.NONE}var t;h!==u.NONE&&s.dispatchEvent(l)}}function G(e){if(!1!==s.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===s.enableRotate)return;if(h!==u.TOUCH_ROTATE)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY),E.subVectors(w,g).multiplyScalar(s.rotateSpeed);var t=s.domElement===document?s.domElement.body:s.domElement;P(2*Math.PI*E.x/t.clientHeight),L(2*Math.PI*E.y/t.clientHeight),g.copy(w),s.update()}(e);break;case 2:if(!1===s.enableZoom&&!1===s.enablePan)return;if(h!==u.TOUCH_DOLLY_PAN)return;!function(e){if(s.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+o*o);j.set(0,n),O.set(0,Math.pow(j.y/C.y,s.zoomSpeed)),H(O.y),C.copy(j)}if(s.enablePan){var r=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);_.set(r,i),M.subVectors(_,x).multiplyScalar(s.panSpeed),D(M.x,M.y),x.copy(_)}s.update()}(e);break;default:h=u.NONE}}function X(e){!1!==s.enabled&&(s.dispatchEvent(p),h=u.NONE)}function Z(e){!1!==s.enabled&&e.preventDefault()}s.domElement.addEventListener("contextmenu",Z,!1),s.domElement.addEventListener("mousedown",I,!1),s.domElement.addEventListener("wheel",U,!1),s.domElement.addEventListener("touchstart",W,!1),s.domElement.addEventListener("touchend",X,!1),s.domElement.addEventListener("touchmove",G,!1),window.addEventListener("keydown",Y,!1),this.update()},B.OrbitControls.prototype=Object.create(B.EventDispatcher.prototype),B.OrbitControls.prototype.constructor=B.OrbitControls,Object.defineProperties(B.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),B.OrbitControls}),define("Viewport",["three","lodash","backbone","cmd","core/loop/RenderingLoop","core/PointerRay","core/Domevents","json!core/viewport/model.json","vendor/three/controls/OrbitControls"],function(a,s,e,c,l,p,u,t){var h={$vp:window,antialias:"default",renderer:"standard",postprocessing:!1,shadowMap:!0,clearColor:"lightgrey",alpha:!0,opacity:.5,camFov:45},d=e.Model.extend({defaults:s.extend({},t.defaults,{$vp:window}),bounds:t.bounds}),o=function(e){var t,o,n,r,i;c.createControl("VP"),c.createControl("Scene"),c.createControl("Camera"),this.options=s.extend({},h,e),this.model=new d,this.clock=new a.Clock,this.model.on("change:camControl",function(){this.control.enabled=this.model.attributes.camControl},this),c.VP.on("disableControl",this.disableControl,this),c.VP.on("enableControl",this.enableControl,this),this.renderer=(o=null,n="default"===(t=this).options.antialias,"deferred"===t.options.renderer?o=new a.WebGLDeferredRenderer({antialias:t.options.antialias,tonemapping:a.FilmicOperator,brightness:2.5,scale:1,width:t.options.$vp.innerWidth,height:t.options.$vp.innerHeight}):((o=new a.WebGLRenderer({alpha:!0,antialias:n})).setSize(t.options.$vp.innerWidth,t.options.$vp.innerHeight),o.shadowMap.enabled=t.options.shadowMap,o.shadowMapSoft=!0,o.setClearColor(new a.Color(t.options.clearColor),t.options.opacity)),o),c.trigger("rendererInitalized",this),this.scene=this.options.scene||new a.Scene,c.trigger("sceneInitalized",this),this.camera=(r=this).options.camera||new a.PerspectiveCamera(r.options.camFov,r.options.$vp.innerWidth/r.options.$vp.innerHeight,1,2e4),c.trigger("cameraInitalized",this),this.options.effect&&a[this.options.effect]?effect=new a[this.options.effect](this.renderer):this.options.effect=!1,this.scene.add(this.camera),h.$vp===window||this.options.$vp[0]===window?document.body.appendChild(this.renderer.domElement):this.options.$vp.append(this.renderer.domElement),(i=this).loop=new l,i.options.postprocessing?i.loop.add(function(){i.scene.overrideMaterial=i.depthMaterial,i.renderer.render(i.scene,i.camera,i.depthRenderTarget,!0),i.scene.overrideMaterial=null,i.composer.render()}):i.options.effect?i.loop.add(function(){i.effect.render(i.scene,i.camera)}):i.loop.add(function(){i.renderer.render(i.scene,i.camera)}),this.scene.addEventListener("update",function(){}.bind(this)),this.DomEvents=new u(this.camera,this.renderer.domElement),this.control=this.options.control||new a.OrbitControls(this.camera,document),this.options.postprocessing,this.raycaster=new p(this),c.trigger("viewportInitalized",this)};return o.prototype.init=function(){c.VP.trigger("initalized",this)},o.prototype.start=function(){this.DomEvents.addEventListener(this.scene,"click",this.onClick.bind(this)),this.clock.getDelta(),this.loop.start(),c.VP.trigger("started",this)},o.prototype.stop=function(){this.loop.stop(),c.VP.trigger("started",this)},o.prototype.disableControl=function(){this.control.enabled=!1},o.prototype.enableControl=function(){this.control.enabled=!0},o.prototype.onClick=function(e){},o});